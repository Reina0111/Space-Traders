let jsonString = `{
    "game_duration": 300,
    "initial_credits": 1984,
    "items": [
        "Dwimeryt",
        "Cynamon",
        "Nuka-Cola",
        "Z\u0142oto",
        "Unobtainium",
        "Protea\u0144skie dyski",
        "Ziemniaki",
        "Lyrium",
        "Murkwie",
        "Woda"
    ],
    "planets": {
        "Alderaan": {
            "available_items": {
                "Cynamon": {
                    "available": 74,
                    "buy_price": 6,
                    "sell_price": 6
                },
                "Dwimeryt": {
                    "available": 42,
                    "buy_price": 12,
                    "sell_price": 11
                },
                "Nuka-Cola": {
                    "available": 34,
                    "buy_price": 13,
                    "sell_price": 12
                },
                "Protea\u0144skie dyski": {
                    "available": 5,
                    "buy_price": 76,
                    "sell_price": 69
                },
                "Unobtainium": {
                    "available": 23,
                    "buy_price": 33,
                    "sell_price": 31
                },
                "Woda": {
                    "available": 22,
                    "buy_price": 19,
                    "sell_price": 18
                },
                "Ziemniaki": {
                    "available": 10,
                    "buy_price": 92,
                    "sell_price": 86
                },
                "Z\u0142oto": {
                    "available": 12,
                    "buy_price": 19,
                    "sell_price": 17
                }
            },
            "x": 15,
            "y": 32
        },
        "Argoland": {
            "available_items": {
                "Dwimeryt": {
                    "available": 23,
                    "buy_price": 10,
                    "sell_price": 10
                },
                "Lyrium": {
                    "available": 39,
                    "buy_price": 9,
                    "sell_price": 8
                },
                "Murkwie": {
                    "available": 5,
                    "buy_price": 73,
                    "sell_price": 64
                },
                "Nuka-Cola": {
                    "available": 25,
                    "buy_price": 22,
                    "sell_price": 19
                },
                "Protea\u0144skie dyski": {
                    "available": 10,
                    "buy_price": 75,
                    "sell_price": 65
                },
                "Ziemniaki": {
                    "available": 6,
                    "buy_price": 69,
                    "sell_price": 61
                },
                "Z\u0142oto": {
                    "available": 12,
                    "buy_price": 34,
                    "sell_price": 30
                }
            },
            "x": 59,
            "y": 44
        },
        "Arrakis": {
            "available_items": {
                "Cynamon": {
                    "available": 59,
                    "buy_price": 8,
                    "sell_price": 7
                },
                "Lyrium": {
                    "available": 53,
                    "buy_price": 10,
                    "sell_price": 8
                },
                "Murkwie": {
                    "available": 6,
                    "buy_price": 89,
                    "sell_price": 76
                },
                "Nuka-Cola": {
                    "available": 25,
                    "buy_price": 16,
                    "sell_price": 15
                },
                "Protea\u0144skie dyski": {
                    "available": 7,
                    "buy_price": 64,
                    "sell_price": 57
                },
                "Unobtainium": {
                    "available": 12,
                    "buy_price": 36,
                    "sell_price": 33
                },
                "Woda": {
                    "available": 12,
                    "buy_price": 25,
                    "sell_price": 21
                },
                "Ziemniaki": {
                    "available": 9,
                    "buy_price": 120,
                    "sell_price": 107
                },
                "Z\u0142oto": {
                    "available": 16,
                    "buy_price": 23,
                    "sell_price": 21
                }
            },
            "x": 81,
            "y": 34
        },
        "Corellia": {
            "available_items": {
                "Dwimeryt": {
                    "available": 38,
                    "buy_price": 8,
                    "sell_price": 8
                },
                "Lyrium": {
                    "available": 63,
                    "buy_price": 8,
                    "sell_price": 7
                },
                "Murkwie": {
                    "available": 6,
                    "buy_price": 91,
                    "sell_price": 84
                },
                "Protea\u0144skie dyski": {
                    "available": 10,
                    "buy_price": 74,
                    "sell_price": 66
                },
                "Unobtainium": {
                    "available": 11,
                    "buy_price": 30,
                    "sell_price": 26
                },
                "Ziemniaki": {
                    "available": 12,
                    "buy_price": 71,
                    "sell_price": 66
                },
                "Z\u0142oto": {
                    "available": 19,
                    "buy_price": 37,
                    "sell_price": 33
                }
            },
            "x": 43,
            "y": 69
        },
        "Encja": {
            "available_items": {
                "Cynamon": {
                    "available": 59,
                    "buy_price": 6,
                    "sell_price": 5
                },
                "Dwimeryt": {
                    "available": 56,
                    "buy_price": 10,
                    "sell_price": 10
                },
                "Lyrium": {
                    "available": 51,
                    "buy_price": 9,
                    "sell_price": 8
                },
                "Murkwie": {
                    "available": 6,
                    "buy_price": 88,
                    "sell_price": 76
                },
                "Nuka-Cola": {
                    "available": 35,
                    "buy_price": 17,
                    "sell_price": 16
                },
                "Protea\u0144skie dyski": {
                    "available": 9,
                    "buy_price": 103,
                    "sell_price": 90
                },
                "Unobtainium": {
                    "available": 13,
                    "buy_price": 39,
                    "sell_price": 37
                },
                "Woda": {
                    "available": 12,
                    "buy_price": 32,
                    "sell_price": 32
                },
                "Ziemniaki": {
                    "available": 6,
                    "buy_price": 60,
                    "sell_price": 57
                },
                "Z\u0142oto": {
                    "available": 26,
                    "buy_price": 40,
                    "sell_price": 35
                }
            },
            "x": 91,
            "y": 32
        },
        "Gaia": {
            "available_items": {
                "Cynamon": {
                    "available": 80,
                    "buy_price": 6,
                    "sell_price": 6
                },
                "Dwimeryt": {
                    "available": 85,
                    "buy_price": 8,
                    "sell_price": 7
                },
                "Lyrium": {
                    "available": 41,
                    "buy_price": 10,
                    "sell_price": 9
                },
                "Protea\u0144skie dyski": {
                    "available": 9,
                    "buy_price": 102,
                    "sell_price": 94
                },
                "Woda": {
                    "available": 25,
                    "buy_price": 43,
                    "sell_price": 39
                },
                "Ziemniaki": {
                    "available": 8,
                    "buy_price": 92,
                    "sell_price": 82
                },
                "Z\u0142oto": {
                    "available": 16,
                    "buy_price": 35,
                    "sell_price": 31
                }
            },
            "x": 75,
            "y": 76
        },
        "Ksi": {
            "available_items": {
                "Cynamon": {
                    "available": 33,
                    "buy_price": 11,
                    "sell_price": 10
                },
                "Dwimeryt": {
                    "available": 80,
                    "buy_price": 6,
                    "sell_price": 6
                },
                "Lyrium": {
                    "available": 64,
                    "buy_price": 8,
                    "sell_price": 7
                },
                "Murkwie": {
                    "available": 4,
                    "buy_price": 73,
                    "sell_price": 67
                },
                "Nuka-Cola": {
                    "available": 30,
                    "buy_price": 17,
                    "sell_price": 14
                },
                "Protea\u0144skie dyski": {
                    "available": 8,
                    "buy_price": 39,
                    "sell_price": 37
                },
                "Unobtainium": {
                    "available": 12,
                    "buy_price": 41,
                    "sell_price": 39
                },
                "Woda": {
                    "available": 15,
                    "buy_price": 30,
                    "sell_price": 28
                },
                "Ziemniaki": {
                    "available": 6,
                    "buy_price": 74,
                    "sell_price": 64
                },
                "Z\u0142oto": {
                    "available": 16,
                    "buy_price": 20,
                    "sell_price": 18
                }
            },
            "x": 91,
            "y": 71
        },
        "Leonida": {
            "available_items": {
                "Cynamon": {
                    "available": 36,
                    "buy_price": 12,
                    "sell_price": 11
                },
                "Dwimeryt": {
                    "available": 50,
                    "buy_price": 8,
                    "sell_price": 7
                },
                "Lyrium": {
                    "available": 60,
                    "buy_price": 9,
                    "sell_price": 9
                },
                "Murkwie": {
                    "available": 6,
                    "buy_price": 89,
                    "sell_price": 85
                },
                "Nuka-Cola": {
                    "available": 39,
                    "buy_price": 18,
                    "sell_price": 16
                },
                "Protea\u0144skie dyski": {
                    "available": 7,
                    "buy_price": 65,
                    "sell_price": 57
                },
                "Unobtainium": {
                    "available": 9,
                    "buy_price": 38,
                    "sell_price": 33
                },
                "Ziemniaki": {
                    "available": 5,
                    "buy_price": 121,
                    "sell_price": 112
                },
                "Z\u0142oto": {
                    "available": 11,
                    "buy_price": 45,
                    "sell_price": 41
                }
            },
            "x": 32,
            "y": 5
        },
        "NowWhat": {
            "available_items": {
                "Cynamon": {
                    "available": 62,
                    "buy_price": 8,
                    "sell_price": 7
                },
                "Dwimeryt": {
                    "available": 22,
                    "buy_price": 9,
                    "sell_price": 9
                },
                "Murkwie": {
                    "available": 9,
                    "buy_price": 67,
                    "sell_price": 66
                },
                "Nuka-Cola": {
                    "available": 27,
                    "buy_price": 18,
                    "sell_price": 16
                },
                "Protea\u0144skie dyski": {
                    "available": 9,
                    "buy_price": 82,
                    "sell_price": 71
                },
                "Ziemniaki": {
                    "available": 4,
                    "buy_price": 74,
                    "sell_price": 63
                },
                "Z\u0142oto": {
                    "available": 17,
                    "buy_price": 28,
                    "sell_price": 24
                }
            },
            "x": 35,
            "y": 41
        },
        "Sur'Kesh": {
            "available_items": {
                "Cynamon": {
                    "available": 55,
                    "buy_price": 9,
                    "sell_price": 8
                },
                "Lyrium": {
                    "available": 34,
                    "buy_price": 9,
                    "sell_price": 8
                },
                "Murkwie": {
                    "available": 10,
                    "buy_price": 73,
                    "sell_price": 66
                },
                "Nuka-Cola": {
                    "available": 30,
                    "buy_price": 19,
                    "sell_price": 17
                },
                "Protea\u0144skie dyski": {
                    "available": 5,
                    "buy_price": 85,
                    "sell_price": 79
                },
                "Unobtainium": {
                    "available": 19,
                    "buy_price": 34,
                    "sell_price": 31
                },
                "Woda": {
                    "available": 21,
                    "buy_price": 23,
                    "sell_price": 20
                },
                "Ziemniaki": {
                    "available": 8,
                    "buy_price": 99,
                    "sell_price": 95
                }
            },
            "x": 39,
            "y": 31
        },
        "Tairia": {
            "available_items": {
                "Cynamon": {
                    "available": 70,
                    "buy_price": 10,
                    "sell_price": 10
                },
                "Lyrium": {
                    "available": 43,
                    "buy_price": 6,
                    "sell_price": 5
                },
                "Murkwie": {
                    "available": 8,
                    "buy_price": 97,
                    "sell_price": 84
                },
                "Nuka-Cola": {
                    "available": 32,
                    "buy_price": 20,
                    "sell_price": 19
                },
                "Unobtainium": {
                    "available": 19,
                    "buy_price": 44,
                    "sell_price": 41
                },
                "Woda": {
                    "available": 12,
                    "buy_price": 29,
                    "sell_price": 25
                },
                "Ziemniaki": {
                    "available": 6,
                    "buy_price": 123,
                    "sell_price": 103
                },
                "Z\u0142oto": {
                    "available": 14,
                    "buy_price": 37,
                    "sell_price": 34
                }
            },
            "x": 36,
            "y": 84
        },
        "Tatooine": {
            "available_items": {
                "Cynamon": {
                    "available": 60,
                    "buy_price": 11,
                    "sell_price": 10
                },
                "Dwimeryt": {
                    "available": 64,
                    "buy_price": 10,
                    "sell_price": 9
                },
                "Lyrium": {
                    "available": 45,
                    "buy_price": 8,
                    "sell_price": 7
                },
                "Murkwie": {
                    "available": 6,
                    "buy_price": 81,
                    "sell_price": 71
                },
                "Nuka-Cola": {
                    "available": 39,
                    "buy_price": 15,
                    "sell_price": 13
                },
                "Protea\u0144skie dyski": {
                    "available": 7,
                    "buy_price": 89,
                    "sell_price": 84
                },
                "Unobtainium": {
                    "available": 13,
                    "buy_price": 37,
                    "sell_price": 32
                },
                "Woda": {
                    "available": 10,
                    "buy_price": 23,
                    "sell_price": 21
                },
                "Ziemniaki": {
                    "available": 7,
                    "buy_price": 95,
                    "sell_price": 87
                },
                "Z\u0142oto": {
                    "available": 19,
                    "buy_price": 35,
                    "sell_price": 32
                }
            },
            "x": 47,
            "y": 68
        },
        "Tuchanka": {
            "available_items": {
                "Cynamon": {
                    "available": 59,
                    "buy_price": 10,
                    "sell_price": 9
                },
                "Dwimeryt": {
                    "available": 51,
                    "buy_price": 7,
                    "sell_price": 6
                },
                "Lyrium": {
                    "available": 65,
                    "buy_price": 11,
                    "sell_price": 10
                },
                "Murkwie": {
                    "available": 9,
                    "buy_price": 90,
                    "sell_price": 82
                },
                "Nuka-Cola": {
                    "available": 46,
                    "buy_price": 18,
                    "sell_price": 16
                },
                "Protea\u0144skie dyski": {
                    "available": 10,
                    "buy_price": 71,
                    "sell_price": 65
                },
                "Unobtainium": {
                    "available": 8,
                    "buy_price": 39,
                    "sell_price": 37
                },
                "Woda": {
                    "available": 15,
                    "buy_price": 28,
                    "sell_price": 24
                },
                "Ziemniaki": {
                    "available": 10,
                    "buy_price": 61,
                    "sell_price": 57
                },
                "Z\u0142oto": {
                    "available": 12,
                    "buy_price": 46,
                    "sell_price": 40
                }
            },
            "x": 27,
            "y": 76
        },
        "Ziemia": {
            "available_items": {
                "Cynamon": {
                    "available": 58,
                    "buy_price": 8,
                    "sell_price": 7
                },
                "Dwimeryt": {
                    "available": 106,
                    "buy_price": 8,
                    "sell_price": 7
                },
                "Lyrium": {
                    "available": 31,
                    "buy_price": 9,
                    "sell_price": 8
                },
                "Murkwie": {
                    "available": 7,
                    "buy_price": 82,
                    "sell_price": 75
                },
                "Nuka-Cola": {
                    "available": 30,
                    "buy_price": 18,
                    "sell_price": 17
                },
                "Unobtainium": {
                    "available": 21,
                    "buy_price": 37,
                    "sell_price": 36
                },
                "Ziemniaki": {
                    "available": 6,
                    "buy_price": 77,
                    "sell_price": 69
                },
                "Z\u0142oto": {
                    "available": 13,
                    "buy_price": 38,
                    "sell_price": 32
                }
            },
            "x": 94,
            "y": 24
        }
    },
    "starships": {
        "Axiom": {
            "cargo_hold_size": 27,
            "position": "Tatooine"
        },
        "Enterprise": {
            "cargo_hold_size": 46,
            "position": "Corellia"
        },
        "Goliath": {
            "cargo_hold_size": 33,
            "position": "Sur'Kesh"
        },
        "Hermes": {
            "cargo_hold_size": 26,
            "position": "NowWhat"
        },
        "Millenium Falcon": {
            "cargo_hold_size": 35,
            "position": "Tatooine"
        },
        "Niezwyci\u0119\u017cony": {
            "cargo_hold_size": 60,
            "position": "Argoland"
        },
        "Normandy SR-2": {
            "cargo_hold_size": 40,
            "position": "Gaia"
        },
        "Nostromo": {
            "cargo_hold_size": 25,
            "position": "Arrakis"
        },
        "Rocinante": {
            "cargo_hold_size": 30,
            "position": "Alderaan"
        },
        "\u041a\u043e\u0441\u043c\u043e\u043d\u0430\u0432\u0442 \u0410\u043b\u0435\u043a\u0441\u0435\u0301\u0439 \u041b\u0435\u043e\u0301\u043d\u043e\u0432": {
            "cargo_hold_size": 35,
            "position": "Arrakis"
        }
    }
}`;
let dataStructure = JSON.parse(jsonString);
let planets = dataStructure.planets;
let ships = dataStructure.starships;
let scoreboard = JSON.parse(localStorage.getItem("Space Traders Scoreboard"));
/* Setting login in game */
let params = (new URL(document.location.href)).searchParams;
let login = params.get('login');
let loginDiv = document.getElementById('login');
loginDiv.textContent = login;
/* Setting starting money in game */
let money = dataStructure.initial_credits;
let moneyInGame = document.getElementById('money');
moneyInGame.textContent = money + "円";
/* Setting starting table of ships */
function setTableOfShips() {
    let table = document.getElementById('Spaceships_table');
    for (let ship in ships) {
        let newRow = table.insertRow();
        let cell = newRow.insertCell();
        cell.textContent = ship;
        cell.setAttribute("onclick", "openShip(\"" + ship + "\")");
        cell.setAttribute("class", "clickable");
        let cell2 = newRow.insertCell();
        cell2.textContent = ships[ship].position;
        cell2.setAttribute("onclick", "openPlanet(\"" + ships[ship].position + "\")");
        cell2.setAttribute("class", "clickable");
        cell2.setAttribute("id", ship + "Position");
    }
}
setTableOfShips();
/* Setting starting table of planets */
function setTableOfPlanets() {
    let table = document.getElementById('Platets_table');
    for (let planet in planets) {
        let newRow = table.insertRow();
        let cell = newRow.insertCell();
        cell.textContent = planet;
        cell.setAttribute("onclick", "openPlanet(\"" + planet + "\")");
        cell.setAttribute("class", "clickable");
        let cell2 = newRow.insertCell();
        cell2.textContent = "(" + planets[planet].x + ", " + planets[planet].y + ")";
    }
}
setTableOfPlanets();
function clear(element) {
    while (element.hasChildNodes()) {
        element.removeChild(element.firstChild);
    }
}
function openShipInSpace(ship) {
    let myName = document.getElementById('nameShipInSpace');
    myName.textContent = ship;
    let myPlanet = document.getElementById('destination');
    myPlanet.textContent = ships[ship].position;
    let time = document.getElementById('time');
    time.textContent = ships[ship].time + " sec";
    let table = document.getElementById('shipStorageInSpace');
    clear(table);
    for (let item in ships[ship].items) {
        let newRow = table.insertRow();
        let name = newRow.insertCell();
        name.textContent = ships[ship].items[item][0];
        let quantity = newRow.insertCell();
        quantity.textContent = ships[ship].items[item][1].toString();
    }
    window.location.href = "#ship_in_space";
}
/* Set ship storage in popup with ship on planet */
function refreshShipStorageOnPlanet(ship) {
    let myName = document.getElementById('nameShipOnPlanet');
    myName.textContent = ship;
    let myPlanet = document.getElementById('position');
    myPlanet.textContent = ships[ship].position;
    if (!ships[ship].items_quantity)
        ships[ship].items_quantity = 0;
    document.getElementById('storage_size').textContent = ships[ship].items_quantity + "/" + ships[ship].cargo_hold_size.toString();
    let table = document.getElementById('shipStorageOnPlanet');
    clear(table);
    for (let item in ships[ship].items) {
        let newRow = table.insertRow();
        newRow.setAttribute("class", "sellItem");
        let name = newRow.insertCell();
        name.textContent = ships[ship].items[item][0];
        let quantity = newRow.insertCell();
        quantity.textContent = ships[ship].items[item][1];
        let price = newRow.insertCell();
        let planetItem = planets[ships[ship].position].available_items[ships[ship].items[item][0]];
        if (planetItem)
            price.textContent = planetItem.sell_price.toString();
        else
            price.textContent = "0";
        let input = newRow.insertCell();
        let inputChild = document.createElement("input");
        inputChild.setAttribute("type", "number");
        inputChild.setAttribute("class", "Quantity");
        input.appendChild(inputChild);
    }
}
/* Set planet storage in popup with ship on planet */
function refreshPlanetStorage(planet) {
    let table = document.getElementById('planetStorageForShip');
    clear(table);
    for (let item in planets[planet].available_items) {
        let newRow = table.insertRow();
        newRow.setAttribute("class", "buyItem");
        let name = newRow.insertCell();
        name.textContent = item;
        let quantity = newRow.insertCell();
        quantity.textContent = planets[planet].available_items[item].available.toString();
        let price = newRow.insertCell();
        price.textContent = planets[planet].available_items[item].buy_price.toString();
        let input = newRow.insertCell();
        let inputChild = document.createElement("input");
        inputChild.setAttribute("type", "number");
        inputChild.setAttribute("class", "Quantity");
        input.appendChild(inputChild);
    }
}
function getTime(start, destination) {
    let xStart = planets[start].x;
    let yStart = planets[start].y;
    let xDest = planets[destination].x;
    let yDest = planets[destination].y;
    return Math.round(Math.sqrt(Math.pow(xStart - xDest, 2) + Math.pow(yStart - yDest, 2)));
}
function makeFlyList(planet) {
    let select = document.getElementById('destination_list');
    clear(select);
    for (let i in planets) {
        if (i !== planet) {
            let element = document.createElement("option");
            element.setAttribute("value", "\"" + i + "\"");
            element.textContent = i;
            select.appendChild(element);
        }
    }
}
function setTime() {
    let currentPlanet = document.getElementById('position').textContent;
    let index = document.getElementById('destination_list').selectedIndex;
    let destination = document.getElementById('destination_list')[index].textContent;
    document.getElementById('next_destination').textContent = "Reached in " + getTime(currentPlanet, destination) + " sec";
}
/* Open popup with ship on planet */
function openShipOnPlanet(ship) {
    refreshShipStorageOnPlanet(ship);
    refreshPlanetStorage(ships[ship].position);
    makeFlyList(ships[ship].position);
    setTime();
    window.location.href = "#ship_on_planet";
}
function startTravel() {
    let ship = document.getElementById('nameShipOnPlanet').textContent;
    let index = document.getElementById('destination_list').selectedIndex;
    let destination = document.getElementById('destination_list')[index].textContent;
    ships[ship].moving = true;
    ships[ship].time = getTime(ships[ship].position, destination);
    ships[ship].position = destination;
    document.getElementById(ship + 'Position').textContent = "on the way";
    document.getElementById(ship + 'Position').removeAttribute("onclick");
    document.getElementById(ship + 'Position').removeAttribute("class");
    openShip(ship);
}
function openShip(ship) {
    if (ships[ship].moving) {
        openShipInSpace(ship);
    }
    else {
        openShipOnPlanet(ship);
    }
}
function openPlanet(planet) {
    if (planet)
        document.getElementById('planetName').textContent = planet;
    let table = document.getElementById('planetStorage');
    clear(table);
    for (let item in planets[planet].available_items) {
        let newRow = table.insertRow();
        let name = newRow.insertCell();
        name.textContent = item;
        let quantity = newRow.insertCell();
        quantity.textContent = planets[planet].available_items[item].available.toString();
        let buyPrice = newRow.insertCell();
        buyPrice.textContent = planets[planet].available_items[item].buy_price.toString() + "円";
        let sellPrice = newRow.insertCell();
        sellPrice.textContent = planets[planet].available_items[item].sell_price.toString() + "円";
    }
    let list = document.getElementById('listOfShipsOnPlanet');
    clear(list);
    for (let ship in ships) {
        if (ships[ship].moving !== true && ships[ship].position === planet) {
            let element = document.createElement("a");
            element.setAttribute("onclick", "openShip(\"" + ship + "\")");
            element.setAttribute("class", "clickable");
            element.textContent = ship;
            let liElement = document.createElement("li");
            liElement.appendChild(element);
            list.appendChild(liElement);
        }
    }
    window.location.href = "#planet";
}
function min(a, b) {
    if (a < b)
        return a;
    else
        return b;
}
function addItemsToPlanet(planet, list) {
    for (let i = 0; i < list.length; i++) {
        let done = false;
        for (let item in planets[planet].available_items) {
            if (list[i][0] === item) {
                planets[planet].available_items[item].available += list[i][1];
                done = true;
            }
        }
        if (!done) {
            planets[planet].available_items[list[i][0]] = { available: list[i][1], buy_price: 0, sell_price: 0 };
        }
    }
}
function removeItemsFromShip(ship, list) {
    let fordelete = [];
    for (let i = 0; i < list.length; i++) {
        for (let item in ships[ship].items) {
            if (list[i][0] === ships[ship].items[item][0]) {
                if (list[i][1] === ships[ship].items[item][1]) {
                    fordelete.push(i);
                }
                ships[ship].items[item][1] -= list[i][1];
            }
        }
    }
    for (let i = fordelete.length - 1; i >= 0; i--) {
        ships[ship].items.splice(i, 1);
    }
}
function sellItems() {
    let ship = document.getElementById('nameShipOnPlanet').textContent;
    let items = document.getElementsByClassName("sellItem");
    let list = [];
    for (let i = 0; i < items.length; i++) {
        let itemName = items[i].children[0].textContent;
        let itemQuantity = items[i].children[1].textContent;
        let itemPrice = items[i].children[2].textContent;
        let soldQuantity = items[i].children[3].childNodes[0].value;
        if (soldQuantity) {
            let element = [itemName, min(Number(soldQuantity), Number(itemQuantity)), itemPrice];
            list.push(element);
        }
    }
    let price = 0;
    let soldItems = 0;
    for (let i = 0; i < list.length; i++) {
        let tmp = Number(list[i][1]) * Number(list[i][2]);
        price = price + tmp;
        soldItems += list[i][1];
    }
    money = money + price;
    moneyInGame.textContent = money + "円";
    ships[ship].items_quantity -= soldItems;
    addItemsToPlanet(ships[ship].position, list);
    removeItemsFromShip(ship, list);
    refreshShipStorageOnPlanet(ship);
    refreshPlanetStorage(ships[ship].position);
}
function addItemsToShip(ship, list) {
    if (!ships[ship].items)
        ships[ship].items = [];
    for (let i = 0; i < list.length; i++) {
        let done = false;
        for (let item in ships[ship].items) {
            if (ships[ship].items[item][0] === list[i][0]) {
                ships[ship].items[item][1] += list[i][1];
                done = true;
            }
        }
        if (!done) {
            let newItem = [list[i][0], list[i][1]];
            ships[ship].items.push(newItem);
        }
    }
}
function removeItemsFromPlanet(planet, list) {
    for (let i = 0; i < list.length; i++) {
        for (let item in planets[planet].available_items) {
            if (list[i][0] === item) {
                planets[planet].available_items[item].available -= list[i][1];
            }
        }
    }
}
function buyItems() {
    let ship = document.getElementById('nameShipOnPlanet').textContent;
    let items = document.getElementsByClassName("buyItem");
    let list = [];
    for (let i = 0; i < items.length; i++) {
        let itemName = items[i].children[0].textContent;
        let itemQuantity = items[i].children[1].textContent;
        let itemPrice = items[i].children[2].textContent;
        let buyedQuantity = items[i].children[3].childNodes[0].value;
        if (buyedQuantity) {
            let element = [itemName, min(Number(buyedQuantity), Number(itemQuantity)), itemPrice];
            list.push(element);
        }
    }
    let price = 0;
    let newItems = 0;
    for (let i = 0; i < list.length; i++) {
        newItems += list[i][1];
        price += list[i][1] * list[i][2];
    }
    if (price <= money &&
        ships[ship].items_quantity + newItems <= ships[ship].cargo_hold_size) {
        money = money - price;
        moneyInGame.textContent = money + "円";
        ships[ship].items_quantity += newItems;
        addItemsToShip(ship, list);
        removeItemsFromPlanet(ships[ship].position, list);
    }
    refreshShipStorageOnPlanet(ship);
    refreshPlanetStorage(ships[ship].position);
}
/* Setting time in game */
let time = dataStructure.game_duration;
let timeInGame = document.getElementById('reimaining_time');
timeInGame.textContent = time + " sec";
function endGame() {
    clearInterval(interval);
    let score = document.getElementById('score').textContent = money;
    let i = 0;
    for (i; i < scoreboard.length; i++) {
        if (scoreboard[i][1] < score)
            break;
    }
    scoreboard.splice(i, 0, [login, score]);
    scoreboard.splice(10, 1);
    console.log(scoreboard);
    window.localStorage.setItem("Space Traders Scoreboard", JSON.stringify(scoreboard));
    window.location.href = "#end_game";
}
/* Updating time in game */
let interval = setInterval(function () {
    if (time > 0) {
        time = time - 1;
    }
    else {
        endGame();
    }
    timeInGame.textContent = time + " sec";
    /* Updating travel time */
    for (let ship in ships) {
        if (ships[ship].moving && ships[ship].time > 0) {
            ships[ship].time--;
            if (document.getElementById('nameShipInSpace').textContent === ship) {
                document.getElementById('time').textContent = ships[ship].time + " sec";
            }
            if (ships[ship].time === 0) {
                ships[ship].moving = false;
                document.getElementById(ship + 'Position').textContent = ships[ship].position;
                document.getElementById(ship + 'Position').setAttribute("onclick", "openPlanet(\"" + ships[ship].position + "\"");
                document.getElementById(ship + 'Position').setAttribute("class", "clickable");
            }
        }
    }
}, 1000);
/**
 * TODO
 *
 * komentarze
 *
 * popup, że nie można kupić
 *
 * przełączenie po dotarciu na planetę
 */ 
//# sourceMappingURL=game.js.map